# Regular Expression RE 正则表达式

## 概述

- 定义: 即文本的高级匹配模式，提供搜索，替换等功能。其本质是由一系列字符和特殊符号构成的字符串，这个字符串即正则表达式。
- 原理：通过特殊符号去描述字符的组成规则，比如重复，位置等，来表达一类字符串，进而匹配。

## 元字符 metacharacter

分类|元字符|反义/非贪婪
-|-|-
匹配字符|. [...] \d \w \s|[^...] \D \W \S
匹配重复|* + ? {n} {n,m} {n,}|*?
匹配位置|^ $ \A \Z \b|\B
分支|\||
分组|() (?P<name>pattern)|
转义|\|

 

### 匹配字符

#### ==普通字符==

- 每个普通字符匹配其对应的字符

- 示例

  ```
  正则表达式：o
  目标字符串：hello world
  匹配结果：[o, o]
  ```

#### ==.==

- 匹配规则 匹配除了换行符以外的任意字符

- 示例

  ```
  正则表达式：o.
  目标字符串：hello world
  匹配结果：[o , or]
  ```


#### ==[字符集]==

- 匹配字符集中任意一个字符

- `[abc#!好]` 匹配其中任意一个

- `[0-9][a-z][A-Z]` 匹配区间中任意一个

- `[_#?0-9-a-z]` 混合书写， 区间写在后边

  ```
  正则表达式：[aeiou]
  目标字符串：hello world
  匹配结果：[e, o, o]
  ```

#### ==\d==

- 匹配任意数字字符，等价于[0-9]

  ```
  \d{1,5}
  mysql:3306, mongo:27017
  [3306, 27017]
  ```

#### ==\w==

- 匹配任意普通字符，普通字符指数字，字母，下划线和汉字等

  ```
  \w+
  server_addr = ('127.0.0.1', 8888)
  [server_addr, 127, 0, 0, 1, 8888]
  ```

#### ==\s==

- 匹配任意空字符，空字符指 ` 空格 \r \n \t \v \f`

  ```
  \w+\s+\w+
  hello    world
  [hello    world]
  ```

  


### 匹配数量

#### ==*==

- 指定前面的内容可以连续重复出现0次或多次

  ```
  wo*
  woooooo~~w!
  [woooooo, w]
  ```

#### ==+==

- 匹配前面的字符出现1次或多次

  ```
  wo+
  woooooo~~w!
  [woooooo]
  ```

#### ==？==

- 匹配前面的字符出现1次或0次

  ```
  wo?
  woooooo~~w!
  [wo, w!]
  ```

#### =={n}==

- 匹配前面的字符出现n次

  ```
  1[0-9]{10}
  tel:13112345678
  [13112345678]
  ```

#### =={n, m}==

- 匹配前面的字符出现n-m次

  ```
  [1-9][0-9]{5,10}
  qq:7981197
  [7981197]
  ```

#### =={n,}==

- 匹配前面的字符重复n次或更多次



### 匹配位置

#### ==^==

- 匹配字符串开始位置

  ```
  ^a
  abcdabcda
  [a]
  ```

#### ==$==

- 匹配字符串的结尾位置

  ```
  d$
  abcdabcd
  [d]
  ```

#### ==\A==

- 匹配字符串开头位置，等同于 `^`

  ```
  \Aabc
  abcdabcd
  [abc]
  ```

#### ==\Z==

- 匹配字符串结尾位置，等同于`$`

  ```
  abc\Z
  abcdabc
  [abc]
  ```

#### ==\b==

- 匹配单词边界位置，单词边界是指普通字符与其他字符的单词边界

  ```
  \bis\b
  This is a test
  [is]
  ```

  

### 反义

用于查找不属于某个能简单定义的字符类的字符

#### ==[^字符集]==

- 字符集取反
- 匹配除了字符集以外的任意一个字符
- `[^x]` 匹配除x外的任意字符
- `[^aeiou]` 匹配除aeiou以外的任意字符

#### ==\W==

- 匹配任意不是字母，数字，下划线，汉字的字符

#### ==\S==

- 匹配任意不是空白符的字符

#### ==\D==

- 匹配任意非数字的字符

#### ==\B==

- 匹配不是单词开头或结束的位置



### 分支匹配

#### ==|==

- 或

- 匹配 `|` 两侧任意正则表达式规则

  ```
  ab|cd
  abcdefg
  [ab, cd]
  ```

- 注意 使用分支时，注意各个条件的顺序，因为匹配分支时，将会从左至右测试每个条件，如果满足某个分支，就不会再匹配其他



### 转义

- 如果使用正则表达式匹配特殊字符，需要添加 ==斜杆== `\` 表示转义

特殊字符：`. * + ? ^ $ [ ] ( ) { } | \`

```

```

- raw 字符串

在字符串前面加r， 表示该字符串为raw字符串，这样的字符串不会进行字符串转义处理

`"\\$\\d+"` ----> `\$\d+` ----> `$100`

`r"\$\d+` ----> `\$\d+` ----> `$100`



### 分组

在正则表达式中，以`( )` 建立正则表达式内部分组，子组是正则表达式的一部分，可以作为内部整体操作，从而改变元字符的操作对象

#### 后向引用

默认情况下，每个分组会自动拥有一个组号，规则是从左向右，以分组的左括号为标志，第一个出现的分组的组号为1，第二个为2，依次类推

==后向引用==

- 用于重复搜索前面某个分组匹配的文本

  ```
  \b(\w+)\b\s+\1\b
  go go
  [go go]
  ```

#### 捕获组

给正则表达式的子组起一个名字，表达一定的意义，该组就是捕获组

格式 ==__(?P<name>pattern)__==



### 零宽断言

#### ==(?=exp)==

- __零宽度正预测先行断言__

- 它断言自身出现的位置的后面能匹配表达式exp

  ```
  \b\w+(?=ing\b)
  # 匹配以ing结尾的单词的前面部分(除了ing以外的部分)
  I'm singing while you're dancing
  [sing, danc]
  ```

### ==(?<=exp)==

- **零宽度正回顾后发断言**

- 它断言自身出现的位置的前面能匹配表达式exp

- 比如(?<=\bre)\w+\b会匹配以re开头的单词的后半部分(除了re以外的部分)，例如在查找*reading a book*时，它匹配ading

  ```
  (?<=\bre)\w+\b
  # 匹配以re开头的单词的后半部分(除了re以外的部分)
  reading a book
  [ading]
  ```

  

### 负向零宽断言

#### ==(?!exp)==

- **零宽度负预测先行断言**
- 断言此位置的后面不能匹配表达式exp
- ：\d{3}(?!\d)匹配三位数字，而且这三位数字的后面不能是数字

#### ==(?<!exp)==

- **零宽度负回顾后发断言**
- 断言此位置的前面不能匹配表达式exp
- (?<![a-z])\d{7}匹配前面不是小写字母的七位数字
- (?<=<(\w+)>).*(?=<\/\1>)匹配不包含属性的简单HTML标签内里的内容



### 注释

==(?#comment)==

- 用来包含注释

- 2[0-4]\d(?#200-249)|25[0-5](?#250-255)|[01]?\d\d?(?#0-199)



__常用分组语法__

分类|语法|说明
-|-|-
捕获|（exp)|匹配exp,并捕获文本到自动命名的组里
捕获|(?P<name>exp)|匹配exp,并捕获文本到名称为name的组里
捕获|(?:exp)|匹配exp,不捕获匹配的文本，也不给此分组分配组号
零宽断言|(?=exp)|匹配exp前面的位置
零宽断言|(?<=exp)| 匹配exp后面的位置                                            
负向零宽断言|(?!exp)|匹配后面跟的不是exp的位置
负向零宽断言|(<?!exp)|匹配前面跟的不是exp的位置
注释|(?#comment)|这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读



### 贪婪与非贪婪

- 贪婪模式 

  默认情况下，匹配重复的元字符总是尽可能多的向后匹配更多的内容，比如 `* + ? {n,m}`

  ```
  a.*b
  aabab
  aabab
  ```

- 非贪婪模式 

  在元字符后面添加 `？` 让元字符尽可能少的匹配内容，比如 `*? +? ?? {n,m}?`

  ```
  a.*?b
  aabab
  aab, ab
  ```



### 正则表达式匹配原则

- 正确性 能过正确地匹配出目标字符串
- 排他性 处理目标字符串外尽可能不匹配其他内容情况
- 全面性 尽可能考虑到目标字符串的所有情况



## Python的re模块

### re模块方法

#### regex = re.compile(pattern, flags=0)

- 生成正则表达式对象
- 参数
  - pattern 正则表达式
  - flags 功能扩展标志位
- 返回值
  - 正则表达式对象 regex

#### list = re.findall(pattern, string, flags=0)

- 通过正则表达式匹配目标字符串
- 参数
  - pattern 正则表达式
  - string 目标字符串
  - flags 功能扩展标志位
- 返回值
  - 返回匹配到的内容列表，如果正则中有子组，则列表中元素为子组对应的内容

#### list = re.split(pattern, string, flags)

- 通过正则匹配内容切割字符串
- 参数
  - pattern 正则表达式
  - string 目标字符串
- 返回值
  - 切割后的内容列表

#### s = re.sub(pattern, rel, string, count, flags=0)

- 使用指定字符串替换匹配到的内容
- 参数
  - pattern 正则表达式
  - rel 指定字符串
  - string 目标字符串
  - count 替换多少处，默认全部替换
- 返回值
  - 返回替换后的字符串

#### it = re.finditer(pattern, string, flags=0)

- 通过正则匹配目标字符串，返回可迭代对象
- 参数
  - pattern 正则表达式
  - string 目标字符串
- 返回值
  - 返回匹配内容的可迭代对象，元素是re.Match Object

#### match_object = re.fullmatch(pattern, string, flags=0)

- 通过正则匹配目标字符串全部内容
- 参数
  - pattern 正则表达式
  - string 目标字符串
- 返回值
  - 返回匹配内容的match对象

#### match_object = re.match(pattern, string, flags=0)

- 通过正则表达式匹配目标字符串起始内容
- 参数
  - pattern 正则表达式
  - string 目标字符串
- 返回值
  - 返回匹配内容的match对象

#### match_object = re.search(pattern, string, flags=0)

- 通过正则表达式匹配目标字符串第一处内容
- 参数
  - pattern 正则表达式
  - string 目标字符串
- 返回值
  - 返回匹配内容的match对象

### regex 正则表达式对象属性

- flags 标志位值
- pattern 正则表达式
- groups 子组数量
- groupindex 捕获组与组序列号形成的字典

### regex正则表达式对象方法

#### list = regex.findall(string, pos, flags=0)

- 通过正则对象对字符串